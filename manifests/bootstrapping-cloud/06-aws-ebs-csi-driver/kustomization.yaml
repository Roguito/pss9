apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kube-system

helmCharts:
# https://github.com/kubernetes-sigs/aws-ebs-csi-driver
- name: aws-ebs-csi-driver
  releaseName: aws-ebs-csi-driver
  namespace: kube-system
  repo: https://kubernetes-sigs.github.io/aws-ebs-csi-driver
  version: "2.17.1"
  valuesInline:
    serviceAccount:
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::977656673179:role/kubeNodeRole-596be7d
    # https://github.com/kubernetes-sigs/aws-ebs-csi-driver/blob/master/docs/parameters.md
    storageClasses:
    - name: gp3-ext4
      annotations:
        storageclass.kubernetes.io/is-default-class: "true"
      reclaimPolicy: Delete
      allowVolumeExpansion: true
      parameters:
        encrypted: "true"
        csi.storage.k8s.io/fstype: ext4
    - name: gp3-xfs
      reclaimPolicy: Delete
      allowVolumeExpansion: true
      parameters:
        encrypted: "true"
        csi.storage.k8s.io/fstype: xfs

patches:
- patch: |-
    apiVersion: v1
    kind: Pod
    metadata:
      name: ebs-csi-driver-test
    spec:
      nodeSelector:
        kubernetes.io/arch: amd64
